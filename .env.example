# Codebase MCP Server - Docker Environment Configuration
# Copy this file to .env and modify values for your environment
# Example: cp .env.example .env

# ============================================================================
# REQUIRED ENVIRONMENT VARIABLES
# ============================================================================
# These must be set for the application to start

# PostgreSQL connection string for the codebase registry database
# Format: postgresql+asyncpg://[user]:[password]@[host]:[port]/[database]
# Development default: Uses docker-compose service name 'postgresql'
REGISTRY_DATABASE_URL=postgresql+asyncpg://postgres:dev-password@postgresql:5432/codebase_mcp

# Ollama embedding service base URL
# For docker-compose: Use service name 'ollama' (container networking)
# For production: Use external Ollama service URL
OLLAMA_BASE_URL=http://ollama:11434

# PostgreSQL admin password (used by docker-compose PostgreSQL service)
# Change this to a secure password in production!
POSTGRES_PASSWORD=dev-password

# PostgreSQL initial database name (created by PostgreSQL container)
POSTGRES_DB=codebase_mcp

# ============================================================================
# OPTIONAL ENVIRONMENT VARIABLES
# ============================================================================
# These have sensible defaults but can be customized

# Ollama embedding model to use for semantic search
# Must be available in Ollama (pre-downloaded or will be downloaded on first use)
# Common models: nomic-embed-text (default, 768 dims), all-minilm-l6-v2 (384 dims)
OLLAMA_EMBEDDING_MODEL=nomic-embed-text

# Batch size for embedding generation
# Larger = faster but uses more memory
# Smaller = slower but uses less memory
EMBEDDING_BATCH_SIZE=32

# Database connection pool configuration
# Minimum number of connections to maintain
DATABASE_POOL_MIN_SIZE=5

# Maximum number of concurrent database connections
DATABASE_POOL_MAX_SIZE=20

# Connection pool timeout (seconds)
DATABASE_POOL_TIMEOUT=30

# Logging configuration
# Levels: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Logging file path (inside container: /tmp/codebase-mcp.log)
# For docker-compose, logs are also available via: docker-compose logs codebase-mcp
LOG_FILE=/tmp/codebase-mcp.log

# PostgreSQL username (default: postgres)
# Usually not needed unless using non-standard PostgreSQL setup
POSTGRES_USER=postgres

# ============================================================================
# DEVELOPMENT VS PRODUCTION
# ============================================================================

# DEVELOPMENT (docker-compose.yml):
# - REGISTRY_DATABASE_URL: postgresql+asyncpg://postgres:dev-password@postgresql:5432/codebase_mcp
# - OLLAMA_BASE_URL: http://ollama:11434
# - POSTGRES_PASSWORD: dev-password (non-secure, OK for local dev)
# - Volume mounts: source code hot reload enabled

# PRODUCTION:
# - REGISTRY_DATABASE_URL: postgresql+asyncpg://user:SECURE_PASSWORD@db.prod.com:5432/codebase_prod
# - OLLAMA_BASE_URL: http://ollama.internal.prod.com:11434
# - POSTGRES_PASSWORD: (use secrets management, never in .env)
# - No volume mounts (code copied in Dockerfile)
# - Use external PostgreSQL and Ollama instances (not containerized)

# TESTING (docker-compose.test.yml):
# - REGISTRY_DATABASE_URL: postgresql+asyncpg://postgres:test-password@postgresql:5432/codebase_test
# - OLLAMA_BASE_URL: http://ollama:11434
# - POSTGRES_PASSWORD: test-password
# - Isolated database and containers (separate from development)
